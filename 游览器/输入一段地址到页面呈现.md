## 前言
### 一 线程VS进程
多线程可以并行处理任务，但是线程是不能单独存在的，它是由进程来启动和管理的，
一个进程就是一个程序的运行实例，详细解释就是，启动一个程序的时候，操作系统会为该程序创建一块内存，用来存放代码、运行中的数据和一个执行任务的主线程，我们把这样的运行环境叫进程，
一个游览器包含一下进程

- 游览器进程：主要负责界面显示、用户交互、子进程管理、同时提供存储等功能。
- 渲染进程：核心任务是将html、css和js转换为用户可以与之交互的网页，排版引擎Blink和js引擎V8都是运行在该进程中，默认情况下，chrome会为每个tab标签创建一个渲染进程，渲染进程都是运行在沙箱模式下的
- GPU进程：一开始Chorme是没有Gpu进程的，GPU的使用是为了实现3D效果
- 网络进程：负责网络资源加载
- 插件进行：运行插件，由于插件的不可靠性容易崩溃，所以单独出来，不对浏览器造成影响

### 站点 same-site
我们将“同一站点”定义为根域名，加上协议，
```js
https://xx.test.com
https://www.test.com
https://www.test.com:8080
```
他们属于同一站点，因为**协议**和**根域名**都相同

** 需要注意的是，如果从一个页面打开了另一个新页面，而新页面和当前页面属于同一站点的话，那么新页面会复用父页面的渲染进程。官方把这个默认策略叫 process-per-site-instance



![image](https://user-images.githubusercontent.com/20312469/170266323-6f3bdfe1-77df-4401-ab47-4fc044160630.png)

- 首先，浏览器进程收到一户输入的URL请求，浏览器进程便将该URL转发给网络进程
- 然后，网络进程进行资源的下载等～
- 接着网络进程接收到了相应数据，便解析响应头数据，并将数据转发给浏览器处理
- 浏览器进程接收到网络进程的响应头数据之后，发送“提交导航”消息到渲染进程
- 渲染进程收到“提交导航”的消息之后，便开始准备接收HTML数据，接收数据的方式是直接和网络进程建立数据管道
- 最后渲染进程会向浏览器进程“确认提交”，告诉浏览器：“准备好接受和解析页面数据了”
- 游览器进程接收到渲染进程“提交文档”的消息之后，便开始移除之前的旧的文档，然后更新游览器进程中页面的状态。

从用户发出URL请求到页面开始解析的过程叫做**导航**

### 1、用户输入地址URL
如果用户输入的内容符合URL规范，游览器会自动转化拼接成对应的地址，否则使用默认的搜索引擎进行搜索～

** 用户在输入并回车之后，游览器会执行 beforeunload 的钩子，可以进行数据清理，或者询问用户是否要离开来取消新页面的导航

### 2、请求过程
浏览器会通过IPC把URL请求发送至网络进程，进程资源下载

网络进程会查找本地缓存是否缓存了该资源，如果有直接返回，如果没有，则进行资源请求

DNS解析(如果请求协议为https还需要建立TLS连接确保当前的证书是安全的)、TCP三次握手、数据资源、TCP四次挥手 

### 3、准备渲染进程
默认情况下浏览器会为每个页面都准备一个渲染进程，也就是，打开一个新的页面会创建一个新的渲染进程（同一站点会共用同一个渲染进程）

### 4、提交文档 浏览器进程将网络进程接收到的数据提交给渲染进程

- 当浏览器进程接收到网络进程的响应头数据之后，便向渲染进程发起“提交文档”的消息；
- 渲染进程接收到”提交文档“的消息之后，会和网络进程建立传入数据的”管道“
- 等文档数据传入完成之后，渲染进程会返回”确认提交“的消息给游览器进程；
- 浏览器进程在收到“确认提交”之后会更新游览器界面的状态，包括安全状态，地址拦URL、History、然后更新web页面

### 5、渲染阶段
文档被提交之后，渲染进程便开始界面解析和子资源的加载，会有对应的dom生成，seyleSheet样式表的生成，layer栏栅的等一些列渲染操作





